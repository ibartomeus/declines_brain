---
title: "Urban bees have larger brains"
output:
  pdf_document:
    fig_caption: yes

link-citations: yes
linkcolor: RoyalBlue
urlcolor: RoyalBlue
fontsize: 12pt

bibliography: 
  - references.bib
  
header-includes:
- \usepackage{orcidlink}
- \usepackage{caption,setspace}
- \captionsetup[figure]{labelformat=empty}
- \usepackage{float} 
- \floatplacement{figure}{H} 
---

\captionsetup[table]{labelformat=empty}

```{r echo=FALSE,warning=FALSE}

knitr::opts_chunk$set(fig.pos = "H", out.extra = "")
```

\orcidlink{0000-0002-4216-317X} \textbf{Jose B. Lanuza$^{1}$} \textbf{, Miguel Á. Collado$^{2}$}  \orcidlink{0000-0002-0287-409X} \textbf{, Ferran Sayol$^{3}$} \orcidlink{0000-0003-3540-7487} \textbf{and Ignasi Bartomeus$^{1}$} \orcidlink{0000-0001-7893-4389}

$^{1}$Estación Biológica de Doñana (EBD-CSIC), E-41092 Seville, Spain

$^{2}$Departamento de Ciencias de la Computación e Inteligencia Artificial, Universidad de Sevilla, Seville, Spain

$^{3}$Centre de Recerca Ecològica i Aplicacions Forestals: Bellaterra, Catalonia, Spain

\textbf{Author for correspondence: barragansljose@gmail.com}

# Abstract

The rapid conversion of natural habitats to anthropogenic landscapes is threatening insect pollinators worldwide, raising concern on the consequences for their fundamental role in ecosystems for fruit and seed production. However, not all pollinators are negatively affected by habitat conversion, but some find in anthropogenic landscapes appropriate resources to survive and reproduce. Why some animals can thrive in anthropogenic environments that most species cannot tolerate remains insufficiently understood, but it might in part reflect enhanced behavioural plasticity to exploit new resource opportunities. While this hypothesis has received ample support in studies of vertebrates, it is less obvious whether the small brain of insects can offer enough behavioural plasticity to cope with the many challenges of anthropogenic habitats. To address this issue, we measured brains for XXX individuals from XX species of bees, the most important group of pollinators, and compared them with detailed information on habitat preferences. Our analyses revealed that bees that prefer forested or agricultural habitats had smaller brains relative to their body size, but those who prefer urban habitats tended to have larger relative brain size. In addition, urban bees also tend to be larger, and hence, show larger absolute brain sizes. These results suggest that a large brain can help maintaining bee urban populations.

Keywords: relative brain size, habitat preference, Apoidea, Urbanization.

\clearpage


[REFEREBCES TO ADD: https://link.springer.com/article/10.1007/s10980-017-0592-x; https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/1365-2435.12486; https://link.springer.com/article/10.1007/s10531-020-02003-8; https://pubmed.ncbi.nlm.nih.gov/28976620/ ; https://www.biorxiv.org/content/10.1101/2022.12.09.519739v1 (this one for big body size in cities in disc. also see https://onlinelibrary.wiley.com/doi/10.1111/eva.13087); https://onlinelibrary.wiley.com/doi/10.1111/ele.14133?af=R (maybe in the intro); https://www.frontiersin.org/articles/10.3389/fevo.2020.00058/full]()

# Introduction

Pollinators deliver a fundamental ecosystem service on which the earth's vegetation and human economy depend [Ollerton](https://www.annualreviews.org/doi/abs/10.1146/annurev-ecolsys-110316-022919). Regrettably, there are clear shreds of evidence of recent declines in pollinator populations [@bartomeus2019; @potts2010; @scheper2014]. Although the reason why many pollinators are declining is insuficiently understood, a factor that is considered central is the loss and alteration of their habitats [@winfree2011]. The destruction and fragmentation of natural habitats and their replacement by anthropogenic landscapes present new challenges for survival and reproduction of organisms, increasing their risk of extinction [@winfree2011, @brown2009]. However, not all pollinator species are equally affected by habitat loss and alteration. In bees, for example, there are also "winners" ---like *Bombus terrestris* [@rasmont2008]--- that are able to thrive in human-altered environments, as well as species that although do not proliferate in such environments can at least maintain self-sustaining populations [@biesmeijer2006; @bartomeus2013; @collado2019].

Human-dominated habitats ---notably cities--- drastically modify the original conditions were pollinators evolved, but can also offer unique ecological opportunities in the form of new nesting spots, reduced predation pressure and high food availability associated with non-indigenous plants [@cane2006; @winfree2011; @collado2019]. The question is then why only some species are able to enjoy the benefits of an urban life. In a novel environment, the chances to successfully survive and reproduce largely depends on cognition, that is, the processes involved in gathering, storing and reacting to environmental information. Cognitive limitations have thus help explaining the low success of many species in novel environments in general, and urban areas in particular. For example, reptiles, amphibians and birds that thrieved after being introduced to new regions outside their native ranges tend to have larger brains (relative to their body size) than unsuccessful invaders [@sol2008; @sol2005; @amiel2011]. [maybe also a sentence on urban dwelers having larger brains? Or if there are good references, replace the concept of invaders, by the one on urban species]() However, similar evidence is lacking for insects, in part because advanced cognitive abilities were not considered possible with their tiny brains until recently [citar a chitka](). We now know that bees and other insects have advanced cognition, being able for instance to use tools to resolve new problems and learn socially how to do so [@alem2016]. Which role plays bees cognitive abilities to adapt to anthropocentric habitats has so far not beeing explored. 

Here, we characterize habitat preference for XXX bee species [@collado2019] and relate this to their brain size, expecting to find bigger brain sizes for urban dwellers because a wider array of cognitive abilities are needed to inhabit these habitats. In vertebrates, relative brain size is a good proxy of problem-solving and learning (REF!!), which can help individuals to cope with the many challenges on novel environments. Despite there was no unequivocal evidence that insect brain size is related to cognitive performance, learning abilities across bee species are reflected in differences in their brain size [Collado et al 2021 PSOS](cite).  Hence, our study explores the long standing idea that species with higher encephalisation (i.e., large brain mass relative to their body) are more likely to thrive in urbanised areas applies also to insects.

\clearpage

# Methods

## Overview

To evaluate our main hypothesis, we have used a dataset of bee species captured in North America and Europe with measurements of brain mass and body size [Sayol et al.](citar). For all these species, we downloaded the occurrence records from the Global Biodiversity Information Facility (GBIF). After filtering the data to avoid possible biases, we extracted the land use classification of the different georeferenced records and summarised them into 3 different categories: (1) natural, (2) agricultural and (3) urban. To evaluate if the different bee species occur more in some habitats than others, we calculated their habitat preference by comparing the observed occurrences with the ones of null models assuming random distributions across habitats [collado et al 2019](). Finally, for the species that showed low and high statistical preference for the different habitats, we investigated how the association between habitat preference and relative brain size changed by habitat type.

All analyses were undertaken in R version 4.0.5 [@r2021] and the manuscript was written in rmarkdown version 2.17 [@markdown2022]. All data processing and graphics were done with the set of packages from the tidyverse version 1.3.0 [@tidyverse19].

```{r Taxonomic information about the dataset, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE}

library(readr)
library(dplyr)

#Load final dataset 
raw = read_csv("../Raw_data/all_cleaning.csv")

d = raw %>% 
group_by(Species) %>% 
summarise(individuals = n())

#Load taxonomic rank script
tax = read_csv("../Data/Processing/taxonomic_rank.csv")

```


## (a) Bee species dataset

Our dataset contains measurements of brain and body size for bee specimens captured by hand netting in different areas of the East Coast of United States and Europe (i.e., Spain and Netherlands). In total, the dataset includes `r sum(d$individuals)` female individuals from `r nlevels(factor(unique(d$Species)))` species that represent `r nlevels(factor(unique(tax$family)))` different families and `r nlevels(factor(unique(tax$genus)))` genera. We only considered female specimens because: (i) females are involved in a larger number of tasks than males and are likely to experience greater selective pressures from the environment; and (ii), there are evident behavioral and morphological differences between sexes that are associated with the size and structure of the brain [@streinzer2013; @roselino2015]. In addition, because brain size can change with age and experience of the different individuals within a species [@durst1994; @withers2008], we limited our sampling to specimens foraging on flowers. Note that 93 of the species used in our study were previously published with their respective trait measurements in @sayol2020.


## (b) Brain and body size measurements

Brain size was measured as the weight of the fixed brain for each specimen. First, all collected individuals were kept in cold and sent to the laboratory where they were identified by expert taxonomists and anesthetized in cold [@crook2013]. Then, heads were removed with a scalpel and placed in a fixative solution (4% paraformaldehyde in 0.1 M phosphate-buffered saline -PBS- pH = 7.4) to avoid degradation. Subsequently, brains were extracted from the head capsule and placed on a petri dish after removing the retina from the optic lobes and cleaning the entire brain of all tracheae and fat bodies. By doing this, we ensured that our brain measurements mainly accounted for neural tissue. We then placed the brains on a small piece of Parafilm® and dried the exceeding fixative solution with Kimwipes® tissues. Then, within 4 seconds of the liquid removal, we weighted the brains with the help of a microbalance Sartorius Cubis®. Finally, we calculated the average weight for the species with more than one specimen. Because weighing bee brains is a highly error-prone task, we excluded values that were under or above 1.5 times the interquartile range for each species.

We considered as a proxy of body size the average intertegular span (ITS) per species. ITS represents the distance between the base of the wings (tegulae) on the bee thorax and has been shown to accurately predict body size as it is highly correlated with dry body weight [@cane1987; @kendall2019]. All ITS measurements were conducted with a stereomicroscope (magnification 16x or 80x) with a calibrated ocular micrometre (resolution down to 0.02 mm).

## (c) Occurrence data

```{r Loading study site areas, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE}

#Calculate study site areas
#Load libraries
library(sf)
library(sfheaders)

#EUROPE:
#Read data
euro_map <- st_read("../Data/Europe_data/euro_map_1.shp", quiet = TRUE)
#Add area col
euro_map$area <- st_area(euro_map)
#Create dataframe with the correct units
d1 = euro_map %>% group_by(CNTR_CODE) %>% summarize(st_union(geometry), area_NAME = sum(area)) %>% 
mutate(areakm2 = units::set_units(area_NAME, value = "km^2"))
#Calculate area
eukm2 = prettyNum(as.numeric(round(sum(d1$areakm2),0)),big.mark=",")

#USA:
#Read data
usa_states_1 <- read.csv("../Data/Usa_data/usa_states.csv")
#Not an sf object, convert into multypolygon
usa = sfheaders::sf_multipolygon(
  obj = usa_states_1
  , multipolygon_id = "group"
  , x = "long"
  , y = "lat"
) %>% st_set_crs(4326)
#Calculate area
usa$area <- st_area(usa)
#Create dataframe with the correct units
d2 = usa %>% group_by(group) %>% summarize(st_union(geometry), area_NAME = sum(area)) %>% 
mutate(areakm2 = units::set_units(area_NAME, value = "km^2"))
#Sum areas
usakm2 = prettyNum(as.numeric(round(sum(d2$areakm2),0)),big.mark=",")

```

```{r Species and occurrences info, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE}

#Read occurrence records and extract relevant info
#Load libraries
library(data.table)
#Load clean data with bee occurrences
europe <- read.table("../Data/Europe_data/all_above_50_europe.csv.gz",  header=T, quote="\"", sep=",")
usa <- read.table("../Data/Usa_data/all_above_50_usa.csv.gz",  header=T, quote="\"", sep=",") 

#Europe
eu_occurrences = prettyNum(nrow(europe), big.mark=",")
records_eu = europe %>% 
group_by(species) %>% 
summarize(no_rows= length(species))

#USA
usa_occurrences = prettyNum(nrow(usa), big.mark=",")
records_usa = usa %>% 
group_by(species) %>% 
summarize(no_rows= length(species))


#Number of species
usa_spp = nrow(records_usa)
eu_spp = nrow(records_eu)
spp_number = nrow(bind_rows(records_eu, records_usa) %>% distinct(species))
spp_shared = nrow(bind_rows(records_eu, records_usa)) - nrow(bind_rows(records_eu, records_usa) %>% distinct(species))

#Median number of records per dataset
eu_median = median(records_eu$no_rows)
usa_median = median(records_usa$no_rows)

#Load now dataset with full set of species
all_spp = readRDS("../Data/Processing/wit.mean.rds")
spp_number_nofilter = nrow(all_spp) #total number of species


```


We downloaded occurrence information for all species from the Global Biodiversity Information Facility (GBIF; http://www.gbif.org/) for North America and Europe. The data was downloaded through R programming language with the help of the function *occ_download* from the package *rgbif* version 3.7.3 [@chamberlain2017]. Because the records were biased towards some areas that were associated with political boundaries, we selected the states or countries with highest density of records for our set of species. We selected the boundaries from the maps packages *spData* version 2.2.0 [@spdata] and *giscoR* vesion 0.3.2 [@giscoR], and extracted the occurrences with the help of the function *st_intersection* from the package *sf* version 1.0-7 [@pebesma2018]. For North America, we selected states located on the East Coast of United States (Figure 1A) that covered an approximate area of `r usakm2` km$^{2}$. These states were: Vermont, New Hampshire, Massachusetts, Rhode Island, Connecticut, New York metropolitan area, New Jersey, Delaware and Maryland. Similarly, we selected countries located on the north and center of Europe (Figure 1B) that represented a total area of `r eukm2` km$^{2}$. These countries were: England, Belgium, Netherlands, Germany and Denmark. All occurrence data used in this study can be downloaded from https://doi.org/10.15468/dl.5s5kuf where just the countries of interest were retrieved. To avoid biases in our analysis, we filtered the occurrence records according the following criteria: (i) we only included species with a distribution larger than the area selected; (ii) all species had a minimum number of 50 records; (iii) all duplicated records were excluded (i.e., records of specimens with the same date and location); (iv) we only included georeferenced records with a minimum of two decimals of latitude/longitude coordinates; and (v), we only included records between the time interval 1990 and 2022 in order to avoid large differences with the extracted land cover classifications, which is from 2006. After pruning the data, our final dataset comprised `r spp_number` species with  `r usa_occurrences` occurrence records for United States (`r usa_spp` species; median occurrences = `r usa_median`) and `r eu_occurrences` records for Europe (`r eu_spp` species; median occurrences = `r eu_median`) wit a total of `r spp_shared` shared species between both regions.

```{r, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE, fig.align="center", fig.height=12, fig.width=12, fig.cap="\\textbf{Figure 1.} Maps showing the study areas and the number of GBIF occurrences in logarithmic scale for the selected bee species. A) East Coast of United States with records for Vermont, New Hampshire, Massachusetts, Rhode Island, Connecticut, New York metropolitan area, New Jersey, Delaware and Maryland. B) European continent with records downloaded for England, Belgium, Netherlands, Germany and Denmark.",  out.width="90%"}

#Plot maps with density of bee occurrences

#Europe----
#Load libraries
library(giscoR) #map of europe
library(ggplot2)
library(dplyr)
library(readr)
library(sf)
library(patchwork)
library(rnaturalearth)

#Load europe map
Europe <- gisco_get_countries(region = "Europe")
#Load countries filtered
euro_map <- st_read("../Data/Europe_data/euro_map_1.shp", quiet = TRUE)
#Load data with records filtered
all_long_lat <- read.table("../Data/Europe_data/all_above_50_europe.csv.gz",  header=T, quote="\"", sep=",")

#Plot Europe map with counties of interest highlighted
p1 = ggplot(Europe) +
geom_sf(fill="gray25",color = "black", alpha = 0.5,size=0.2)  +
geom_sf(data= euro_map %>% group_by(CNTR_CODE) %>% summarise() ,
aes(fill = CNTR_CODE, group=CNTR_CODE),fill = "#f2ea69", color = "black",alpha=0.8, size = 0.25) +
coord_sf(xlim = c(-10, 30), ylim = c(35, 65))  + 
microplot::theme_collapse(panel.border = element_rect(colour = "black", fill=NA, size=2),
panel.background = element_rect(fill = "white"))


p2 = ggplot(Europe) +
geom_sf(fill="gray80",color = "black", alpha = 1,size=0.2)+
geom_bin2d(data = all_long_lat, aes(x = long, y = lat, fill=log(..count..)),size = 1,bins=70) +
viridis::scale_fill_viridis(name = "log(Count)", breaks = c(0, 4, 8), limits=c(0,8)) +
coord_sf(xlim = c(-8, 18), ylim = c(40, 60)) +
theme(panel.background = element_rect(fill = "white"),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
ylab("Latitude") +
xlab("Longitude") +
ggtitle("B") +
theme(legend.position = c(0, 1),legend.justification = c(0, 1),
legend.background = element_blank(),
legend.box.background = element_blank(),
legend.key = element_blank(), 
legend.title = element_text(face = "bold"),
axis.title = element_text(face="bold", size = 14),
plot.title = element_text(face="bold", size = 18),
legend.text = element_text(face = "bold", size = 12), legend.direction="horizontal") +
scale_y_continuous(breaks = seq(40, 60, by = 6)) +
scale_x_continuous(breaks = seq(-8, 18, by = 8)) +
guides(fill = guide_colourbar(title.position = "top", title.hjust = .5)) +
ggspatial::annotation_scale(location = 'br',  bar_cols = c("grey60", "white"),  width_hint = 0.15) 


#Insert general plot within specific plot
panel1 = p2 + inset_element(p1, left = 0, bottom = -0.89 , right = 0.35, top = 1.23, ignore_tag = TRUE) 

#USA-----
#Load libraries

#Load data
usa_states_1 <- read.csv("../Data/Usa_data/usa_states.csv")
ny_metropolitan_1 <- read.csv("../Data/Usa_data/ny_metropolitan.csv")
all_long_lat <- read.table("../Data/Usa_data/all_above_50_usa.csv.gz",  header=T, quote="\"", sep=",")

#Load maps
canada <- ne_states(country = "canada", returnclass = "sf") %>%
st_as_sf(crs = 4326) 

usa <- ne_states(country = "united states of america", returnclass = "sf") %>%
st_as_sf(crs = 4326)

p1 = ggplot(canada) + 
geom_sf(fill="gray60",color = "black", alpha = 1,size=0.2) + 
geom_sf(data= usa, fill="gray60",color = "black", alpha = 1,size=0.2) + 
microplot::theme_collapse(panel.border = element_rect(colour = "black", fill=NA, size=2),
panel.background = element_rect(fill = "white")) +
geom_map(data = ny_metropolitan_1, 
map = ny_metropolitan_1,aes(long, lat, map_id = region, group = group), fill = "#f2ea69",color = "black",
size = 0.1) +
geom_map(data = usa_states_1, map = usa_states_1,
aes(long, lat, map_id = region, group = group), color = "black", fill = "#f2ea69",
size = 0.1) +
coord_sf(xlim = c(-86, -62), ylim = c(25, 48)) 


p2 = ggplot(canada) + 
geom_sf(fill="gray80",color = "black", alpha = 1,size=0.2) + 
geom_sf(data= usa, fill="gray80",color = "black", alpha = 1,size=0.2) +
geom_bin2d(data = all_long_lat, aes(x = long, y = lat, fill=log(..count..)),size = 1,bins=50) +
viridis::scale_fill_viridis(name = "log(Count)", breaks = c(0, 4, 8), limits=c(0,8)) +
coord_sf(xlim = c(-82, -67), ylim = c(33, 47))  +
theme(panel.background = element_rect(fill = "white"),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
ylab("Latitude") +
xlab("Longitude") +
ggtitle("A") +
theme(legend.position = c(0, 1),legend.justification = c(0, 1),
legend.background = element_blank(),
legend.box.background = element_blank(),
legend.key = element_blank(),
legend.title = element_text(face = "bold"),
axis.title = element_text(face="bold", size = 14),
plot.title = element_text(face="bold", size = 18),
legend.text = element_text(face = "bold", size = 12, hjust=0), legend.direction="horizontal") +
scale_y_continuous(breaks = seq(33, 47, by = 4)) +
scale_x_continuous(breaks = seq(-82, -67, by = 4)) +
guides(fill = guide_colourbar(title.position = "top", title.hjust = .5))+ 
ggspatial::annotation_scale(location = 'br',  bar_cols = c("grey60", "white"))


#Insert general plot within specific plot
panel2 = p2 + inset_element(p1, left = 0, bottom = -0.86, right = 0.35, top = 1.2, ignore_tag = TRUE) 

library(patchwork)
panel2  + panel1



```

## (d) Land cover classification

We assigned a habitat type to each GBIF occurrence by merging land cover information with the different georeferenced records. The land cover classification was obtained from the 2006 online inventories of the National Land Cover Database (NLCD) for United States and the Corine Land Cover (CLC) for Europe. After downloading these as raster files, we used the functions *rast* and *extract* from the *Terra* package version 1.6-41 [@hijmans2022] to read and obtain the cover classification of the different georeferenced records, respectively. Then, to simplify the interpretation and conduct a joint analysis for both occurrence datasets, we divided the resulting cover classes into three single categories: (i) natural, (ii) agricultural and (iii) urban. The original extracted cover classes and our classification into these three different categories are shown in Table S1 for United States and Table S2 for Europe.    

## (e) Construction of the phylogenetic tree

We constructed a phylogeny with all studied species by using a previously published genus-level bee phylogeny [@hedtke2013]. For this, we first read the backbone phylogeny with the function *read.tree* and drop the missing genera with function *drop.tip* from the package *ape* version 5.6-2 [@paradis2019]. Then, we selected as an outgroup a wasp genera (*Tachysphex*) and recalculated distances to the root with the function *chronos* from *ape*. Species tips were added to genera nodes as polytomies of equal branch length relative to the genera branch length using the phytools package version 1.2-0 [@revell2012]. From the resulting tree, we created a scaled phylogenetic covariance matrix with the function *inverseA* from the package *MCMCglmm* version 2.33 [@hadfield2010]. Finally, we estimated the phylogenetic signal of relative brain size and habitat preference across habitats (see next section) for our set of species with the help of the function *phylosig* from the *phytools* package.

## (f) Analysis

We estimated brain size relative to body size modeling the log-transformed association between brain weight and intertegular span. For this, we specified a simple Bayesian regression with the function *brm* from the package *brms* version 2.18 [@burkner2017] where brain weight was the response variable and intertegular span the predictor. To correct for the non-independent evolutionary histories among species, we included the phylogenetic covariance matrix as random factor. Note that this matrix contained all species of our dataset (N = `r spp_number_nofilter`) because we expect better predictive power with a larger sample size than the one with the filtered dataset (N = `r spp_number`). Lastly, we extracted the differences between the observed and predicted values (i.e., residuals) that represent the relative brain size. High values indicate larger brains than expected for their body size and low values denote smaller brains than expected.

Habitat preference was estimated by comparing species occurrences per habitat with the ones that we would expect if they occur at random. For this, we generated from our occurrence matrix 10,000 randomised matrices with help of the function *nullmodel* from the package *bipartite* version 2.16 [@dormann2008]. We implemented this function with the method 'r2dtable' which maintains row and column sums constant by using Patefield's algorithm [@patefield1981]. In other words, it maintains the proportional dominance of the species and habitats constant but reshuffles their associations. We then estimated the percentage of simulated occurrences per species and habitat that were under the observed ones (i.e., percentile). Finally, we considered that a bee species exhibited statistical preference when the observed occurrences per species and habitat were below 20th percentile (i.e., low preference) or above the 80th percentile (i.e., high preference) in comparison with the values obtained from the simulations.

To evaluate how the association between habitat preference and relative brain size changed by habitat type, we modeled with Bayesian generalised linear models their association. For this, we first joined the resulting habitat preference and relative brain size datasets by species and extracted those with statistical habitat preference on any of these three habitats. Because we assessed habitat preference as binary (low or high), we specified a Bernouilli distribution where habitat preference was the response variable and relative brain size the predictor. Again, we included the phylogenetic covariance matrix as random factor. Moreover, we also explored how habitat preference changed by brain weight and intertegular span independently. For this, we conducted two analogous models with these two different predictors. Finally, we also investigated the different trends for United States and Europe separately. 

All our models were run with 4,000 iterations with previous 1,000 warm up iterations and with non or very weakly informative priors from the brm function so the priors had negligible influence on the results [@burkner2017]. Finally, the different posterior predictive checks were conducted with the function *pp_check* also from the *brms* package.

# Results

```{r Trait info, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE}
library(dplyr)
#Load brain data
brain_weight = readr::read_csv("../Data/Processing/brain_weight_data.csv")
#Load preferences data
preferences_usa = readr::read_csv("../Data/USA_data/preferences_usa.csv") 
preferences_eu = readr::read_csv("../Data/Europe_data/preferences_europe.csv") 
#Bind rows
pref = bind_rows(preferences_usa, preferences_eu)
#Select unique species
sp = pref %>% distinct(Species) %>% pull()

#Filter species that are in the phylo
brain_weight = brain_weight %>% filter(Species %in% sp)
largest_encephalisation = brain_weight %>% filter(residuals == max(residuals)) %>% select(Species) %>% pull()
lowest_encephalisation = brain_weight %>% filter(residuals == min(residuals)) %>% select(Species) %>% pull()

#Read model output
r2 = read_rds("../Data/Processing/bayessianr2.rds")
r2 = round(r2[1],2)

#Read phylo signal
phylo = read_rds("../Data/Processing/phylo_signal.rds")
lambda = round(phylo$lambda, 2)
phylo_nat = read_rds("../Data/Processing/phylo_signal_natural.rds")
lambda_nat = round(phylo_nat$lambda, 2)
p_nat = round(phylo_nat$P,2)

#Read summary of habitat preference
#Load preferences data
preferences_usa = readr::read_csv("../Data/USA_data/preferences_usa.csv") 
preferences_eu = readr::read_csv("../Data/Europe_data/preferences_europe.csv") 
#Bind rows
pref = bind_rows(preferences_usa, preferences_eu)
#Average preferences between USA and Europe
preferences = pref %>% 
group_by(Species) %>%
summarise(across(everything(), list(mean),.names = "{.col}")) %>% 
ungroup()
#Agricultural
pref_agr = pref %>% 
dplyr::select(Agricultural) %>%  
filter(Agricultural > 0.80) %>% 
nrow()
#Natural
pref_nat = pref %>% 
dplyr::select(Natural) %>%  
filter(Natural > 0.80) %>% 
nrow()
#Urban
pref_urb1 = pref %>% 
dplyr::select(Urban) %>%  
filter(Urban < 0.20) %>% 
nrow()
#Urban
pref_urb2 = pref %>% 
dplyr::select(Urban) %>%  
filter(Urban > 0.80) %>% 
nrow()

#Read R2 MAIN MODEL
r2_main = readRDS("../Data/Processing/r2_main.rds")
r2_main = round(r2_main[[1]],2)
#Read R2 MODEL BRAIN WEIGHT
r2_brain = readRDS("../Data/Processing/r2_brain.rds")
r2_brain = round(r2_brain[[1]],2)
#Read R2 MODEL ITS
r2_its = readRDS("../Data/Processing/r2_its.rds")
r2_its = round(r2_its[[1]],2)

```

Our dataset showed that brain size scaled allometrically with body size (Bayesian R$^2$ = `r r2`). As expected, this allometric relationship was constrained by the evolutive history of the species (phylogenetic signal of relative brain size, $\lambda$ = `r lambda`; *P* < 0.01). However, we found considerable variability in relative brain size within and across the different taxonomic groups (i.e., genera and subfamily level; Figure S1; Figure 2A). Similarly, habitat preference varied substantially across species (Figure 2B) but showed none (i.e., preference for agricultural and rural habitats) or moderate phylogenetic signal (i.e., preference for natural habitat; $\lambda$ = `r lambda_nat`; *P* = `r p_nat`). In general, most bee species preferred one or two habitat types but more rarely occurred indistinctively in the three habitats (Figure 2B). The most preferred habitats were the agricultural and natural ones with `r pref_agr` and `r pref_nat` species over 80% of the values from null models, respectively (Figure 2B and Figure 3). In contrast, most species avoided or had low preference for urban habitats (`r pref_urb1` species under the 20th percentile) and just `r pref_urb2` species showed high preference for this habitat type (Figure 2B and Figure 3). The resulting distribution of habitat preferences for each of the different habitats followed a zero-one inflated beta distribution (Figure 3). In other words, there were high frequencies of habitat preferences equal to 0 or 1 but low frequencies of intermediate values between 0 and 1.

Our models evaluating how relative brain size was associated with habitat preference explained little of the overall variance (Bayesian R$^2$ = `r r2_main`). However, we found differences when we explored this association for each of the habitat types (Figure 4A). Specifically, we found that bees with larger brains relative to their body showed a higher preference for urban habitats than bees with smaller relative brain sizes (Figure 4A). Contrary, bees with smaller brains relative to their body showed higher preference in natural and agricultural habitats that bees with larger relative brain sizes (Figure 4A). Although the models of the association between brain size and intertegular span captured also little of the overall variance (Bayesian R$^2$ = `r r2_brain`; Bayesian R$^2$ = `r r2_its`, respectively), we found more marked differences in this case between habitat types (Figures 4B and 4C). Specifically, we found that bees with larger brains and body sizes tend to appear more in urban habitats and bees with smaller brains and body sizes are more common in natural and agricultural one (Figures 4B and 4C). These findings were consistent with the analogous analyses separated by geographical regions (United States and Europe; Figure S2). 

```{r, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE,fig.align="center", fig.height=12, fig.width=12,fig.cap="\\textbf{Figure 2.} Phylogenetic relationship and habitat preferences for the selected bee species with brain weight and intertegular distance information (N=89). A) Phylogenetic tree at the genera level. Tree branches are coloured based on the geographical location of the different bee species (North of Europe, East Coast of United States or from both regions). The deviation of the brain size in relation to the body (i.e., residuals) is indicated with weighted points at the end of the tip branches. Larger points indicate larger brains in proportion to their body size and vice versa. B) Heatmap showing the habitat preference for each bee species. The columns delimit the habitat type (i.e., natural, agricultural, semideveloped and urban) and the rows the different bee species."}


library(ggtree) #v3.5.3.002
library(ggplot2)
library(stringr)
library(tidyverse)
library(tibble)

#Load phylogenetic data from europe
bee.tree100 = readRDS("../Data/Europe_USA/bee.tree100.rds")
#Load brain data
brain_weight = readr::read_csv("../Data/Processing/brain_weight_data.csv")
#Load preferences data
preferences_usa = readr::read_csv("../Data/USA_data/preferences_usa.csv") 
preferences_eu = readr::read_csv("../Data/Europe_data/preferences_europe.csv") 
#Bind rows
pref = bind_rows(preferences_usa, preferences_eu)


#Average preferences between USA and Europe
preferences = pref %>% 
group_by(Species) %>%
summarise(across(everything(), list(mean),.names = "{.col}")) %>% 
ungroup()


#Delete underscore from tree
bee.tree100$tip.label = str_replace(bee.tree100$tip.label, "_", " ")

#Generate vector with species
v = bee.tree100$tip.label
#Filter species with that are in the phylo
brain_weight = brain_weight %>% filter(Species %in% v)


#Fill a column based on condition
brain_weight = brain_weight %>% 
    mutate(Country = case_when((brain_weight$Species %in% preferences_eu$Species & 
    brain_weight$Species %in% preferences_usa$Species ~ "USA and Europe"),
    (brain_weight$Species %in% preferences_usa$Species ~ "USA"),
    (brain_weight$Species %in% preferences_eu$Species ~ "Europe")))


#Plot tree
p <- ggtree(bee.tree100) %<+% brain_weight  +  aes(color=Country)+
    geom_tippoint(aes(size = residuals, color=Country))+
    theme_tree2()+scale_size_continuous(range = c(-1, 4),name="Relative\nbrain size")+
    scale_color_manual(name = "Data", values=c("darkgoldenrod1","cyan4","black"),
                       labels = c("Europe", "USA", "USA and Europe"),
                       breaks = c("Europe", "USA", "USA and Europe")) +
  ggtitle("A") + theme(plot.title = element_text(size=18, face="bold"))

#Convert wide format to long for plotting heatmap
d=gather(preferences, condition, measurement, Agricultural:Urban, factor_key=TRUE)


#Relevel for plotting
d = d %>% 
mutate(condition=fct_relevel(condition,c("Natural","Agricultural", "Urban"))) 


p2 = ggplot(d, aes(x=condition, y=Species)) + 
    geom_tile(aes(fill=measurement),color = "white") +
   # scale_fill_gradient(high="black",  low="white") +
    scale_fill_viridis_c(name = "Habitat\npreference") + 
    theme_minimal() +
    xlab(NULL) + 
    ylab(NULL) + 
    theme(axis.text.x = element_text(face="bold", color="black", 
    size=7.5,  vjust=1.15),
    axis.text.y = element_text(face="italic", color="black", size=7.5, hjust=0),
    plot.title = element_text(size=18, face="bold")) +
   ggtitle("B")

#Nice way to insert ordered heatmap
library(aplot)
p2 %>% insert_left(p) 
```

\clearpage


```{r, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE,fig.align="center", fig.height=5, fig.width=12, fig.cap="\\textbf{Figure 3.} Frequency distribution of the bee preferences for each habitat type (i.e., natural, agricultural and urban). The different habitats are reclassifications from the 2006 land use categories of the Corine Land Cover (CLC) inventory for Europe and the National Land Cover (NLC) database for Unites States.", fig.pos="p"}

#Histogram of habitat preferences
#Load libraries
library(tidyverse) 

#Load preferences
preferences_europe = read_csv("../Data/Europe_data/preferences_europe.csv") 
preferences_usa = read_csv("../Data/Usa_data/preferences_usa.csv") 

#Merge datasets
preferences = bind_rows(preferences_europe, preferences_usa)

#Convert to long to model everything at the same time
long_data = preferences %>% gather(Habitat, Preference, 2:4, -c(Species))

#Relevel for plotting
long_data = long_data %>% 
mutate(Habitat=fct_relevel(Habitat,c("Natural","Agricultural", "Urban"))) 

labels.minor <- c("Avoidance", rep("", times = 2), "Preference","")

long_data$Habitat <- factor(long_data$Habitat, levels = c("Natural", "Agricultural", "Urban"),labels = c("A) Natural", "B) Agricultural", "C) Urban"))

long_data = long_data %>% 
mutate(Preference_colour = case_when(Preference <= 0.2 ~ "A", Preference >= 0.8 ~ "B", T ~ "C"))

long_data$Preference_colour <- factor(long_data$Preference_colour, levels = c("A","C", "B"), labels = c("Low preference", "No preference", "High preference"))


ggplot(long_data, aes(x=Preference, color= Preference_colour)) +
    geom_histogram(aes(fill= Preference_colour),bins = 35, alpha = 0.8,linewidth=0.5) + 
    xlab("Habitat preference") +
    ylab("Frequency") +
    facet_wrap(~ Habitat) +
    scale_fill_manual(name="" ,values=c("coral2", "gray", "palegreen3")) +
    scale_color_manual(name="" ,values=c("coral2", "gray", "palegreen3")) +
    theme_bw() +   
    theme(axis.title = element_text(face = "bold", size = 14),
    panel.border=element_rect(size=1),
    strip.text = element_text(face = "bold", size = 18,hjust = -0.01),
    strip.background = element_rect(fill = NA, colour = NA, size = 0,linetype="solid"),
    panel.grid.minor=element_blank())+
    scale_y_continuous(expand = c(0, 0), limits = c(0,60))+
    geom_vline(aes(xintercept = 0.20), colour="black", linetype="dashed") +
    geom_vline(aes(xintercept = 0.80), colour="black", linetype="dashed") +
    scale_x_continuous(breaks = seq(from = 0, to = 1, by = 0.2),
                       labels = c(0,0.2,0.4,0.6,0.8,1)) +
  theme(legend.position = 'bottom', legend.box.background = element_rect(colour = "black",size=1))




```

\clearpage

```{r, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE,fig.align="center", fig.height=6, fig.width=10, fig.cap="\\textbf{Figure 4.} Association between relative brain size (A), brain weight (B) and intertegular distance (C) with habitat preference by habitat type (i.e., natural, agricultural and urban). The shaded and coloured areas by habitat type represent 95\\% credible intervals.", fig.pos="p"}

#Load libraries
library(readr)
library(dplyr)
library(ggplot2)

#Load data for plotting
long_data <- read_csv("../Data/Europe_USA/data_preference_residuals_europe_usa_qualitative.csv")

model1 = read_csv("../Data/Europe_USA/model_output_preference_residuals_europe_usa_qualitative.csv")

model2 = read_csv("../Data/Europe_USA/model_output_preference_brain_weight_europe_usa_qualitative.csv")

model3 = read_csv("../Data/Europe_USA/model_output_preference_it_europe_usa_qualitative.csv")


#Relevel for plotting
long_data = long_data %>% 
    mutate(Habitat=fct_relevel(Habitat,c("Natural","Agricultural", "Urban"))) 
#Relevel for plotting
model1 = model1 %>% 
    mutate(Habitat=fct_relevel(Habitat,c("Natural","Agricultural", "Urban"))) 
#Relevel for plotting
model2 = model2 %>% 
    mutate(Habitat=fct_relevel(Habitat,c("Natural","Agricultural", "Urban"))) 
#Relevel for plotting
model3 = model3 %>% 
    mutate(Habitat=fct_relevel(Habitat,c("Natural","Agricultural", "Urban"))) 

#colorBlindness::displayAllColors(viridis::viridis(4))

set.seed(3)

all_1 = ggplot(model1, aes(x = residuals, y = estimate__, color=Habitat)) +
geom_jitter(width = 0.05, height = 0,data =  long_data, aes(x = residuals, y = (Preference)), shape=21, size=2.5) +
geom_line(aes(color=Habitat),size=0.7) +
geom_ribbon(aes(ymin = lower__, ymax = upper__,  fill = Habitat),color=NA, linetype = "dashed",alpha = 0.2)+
theme_bw() +
ylab("Habitat preference") +
xlab("Relative brain size") +
scale_colour_viridis_d() +
scale_fill_viridis_d() +
scale_y_continuous(breaks = seq(0, 1, by = 1),labels = c("Low", "High")) +
ggtitle("A") +
theme(plot.title = element_text(face = "bold", size=18))
  


all_2 = ggplot(model2, aes(x = Brain.weight, y = estimate__, color=Habitat)) +
geom_point(data =  long_data, aes(x = Brain.weight, y = (Preference)), shape=21, size=2.5) +
geom_line(aes(color=Habitat),size=0.7) +
geom_ribbon(aes(ymin = lower__, ymax = upper__,  fill = Habitat),color=NA, linetype = "dashed",alpha = 0.2)+
theme_bw() +
ylab(NULL) +
xlab("Brain weight (mg)") +
scale_colour_viridis_d() +
scale_fill_viridis_d() +
scale_y_continuous(breaks = seq(0, 1, by = 1),labels = c("Low", "High")) +
ggtitle("B") +
theme(plot.title = element_text(face = "bold", size=18))



all_3 = ggplot(model3, aes(x = IT, y = estimate__, color=Habitat)) +
geom_point(data =  long_data, aes(x = IT, y = (Preference)), shape=21, size=2.5) +
geom_line(aes(color=Habitat),size=0.7) +
geom_ribbon(aes(ymin = lower__, ymax = upper__, fill = Habitat),color=NA, linetype = "dashed",alpha = 0.2)+
theme_bw() +
ylab(NULL) +
xlab("Intertegular distance (mm)") +
scale_colour_viridis_d() +
scale_fill_viridis_d() +
scale_y_continuous(breaks = seq(0, 1, by = 1),labels = c("Low", "High")) +
ggtitle("C") +
theme(plot.title = element_text(face = "bold", size=18))


library(patchwork)

all_1 + (all_2/all_3) + plot_layout(guides = "collect") &
theme(legend.position = 'bottom', panel.border=element_rect(size=1),
      axis.title=element_text(face="bold"),
      legend.box.background = element_rect(colour = "black",size=1))


```

\clearpage

# Discussion

Bees with a preference for inhabiting urban habitats tended to have bigger brains related to their body sizes, and those with forest or agricultural  preferences had relatively smaller brains. This pattern is highly suggestive, because investing in brain tissue is expensive (REF), and hence it only payoff in unpredictable habitats where a flexible behavior is needed. When the environment is stable, small relative brains are cost-effective to exploit predictable resources, but in highly unpredictable environments, a large brain can confer the needed flexibility to exploit unpredictable resources. Indeed, specialist bees also tend to have larger brains [@Sayol](cite apropietely), as they need to locate and memorize patchy resources. This same complex learning and navigation skills may be also needed in urban environments. Urban habitats are typically harsher, with less and/or new resources to explore, also containing new unknown threats and a highly changing environment (Wheater, 1999). Hence, urban dwellers may need to have better cognitive abilities and flexibility in their behavior than forest or agricultural bees. 

Some examples of behaviours needed to survive in urban environments are the use of human-made materials to nest (Allasino et al., 2019) or being able to collect pollen and nectar from exotic flowers from gardens (Lowenstein et al., 2014). We should not expect forested habitats to require such a plastic behaviour because the resources found in these habitats are homogeneous, stable, and bees are already pre-adapted to use them (Smith et al., 2019). In addition, other traits have already been described to be filtered out in cities, such as smaller body sizes (REF), early spring species or brood parasites (Harrison et al., 2017). We also found small species to be less frequent in urban habitats, maybe as a consequence of the patchy resource distribution, which need from larger body sizes, which confer larger foraging ranges, to be accessed [Kendal et al](cite the 2022 on foraging-body size relationship).   

Despite brain weight is relatively easy to measure and standardize with the used protocol, recent studies challenge the use of brain size as an estimator for behavioral complexity and computational power (Chittka and Niven, 2009, and references therein). However, many studies have shown correlations between brain size and performance (Deaner et al., 2007; Gronenberg and Couvillon, 2010; Lefebvre and Sol, 2008), and brain size is correlated with learning abilities in bees (Collado et al 2021). Finer scale measures such as neuropils size or detailed mushroom bodies measurements (the suspected centers of cognitive processes in bees; Barth & Heisenberg, 1997; Withers et al., 1995; Fahrbachand & Robinson 1995) could further explain differences in behaviours, and in consequence, shed extra light on species habitat associations. In any case, raw measures of brain size have the advantage to allow for larger comparisons across species. 

In conclusion, the fact that urban bees tend to have larger relative brain sizes highlights the importance of cognitive process for understanding the dynamics of insect populations, and stress the importance of considering behavioural responses beyond vertabrate taxa.

\newpage

# References

::: {#refs}
:::

\clearpage

# Supplementary material

```{r Table S1, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE, fig.align="center"}

#Create table of occurrences per habitat type (USA)
#Load libraries
library(tidyverse)
library(kableExtra)

#Load extracted data
pref <- read_csv("../Data/Usa_data/land_cover_usa.csv.gz") %>% 
dplyr::select(species, cover.names) %>% 
mutate_if(is.character,as.factor) 

#Create table with original and new cover categories
pref %>% 
rename(Cover_names = cover.names) %>% 
select(Cover_names) %>% 
group_by(Cover_names) %>% 
summarise(Occurrences = length(Cover_names)) %>% 
mutate(Cover_names1 = fct_recode(as.factor(Cover_names),
       Discarded = "Barren Land", 
       Agricultural = "Cultivated Crops", 
       Natural = "Deciduous Forest", 
       Urban = "Developed, High Intensity", 
       Urban = "Developed, Medium Intensity",
       Urban = "Developed, Low Intensity",
       Urban = "Developed, Open Space", 
       Natural = "Emergent Herbaceous Wetlands", 
       Natural = "Evergreen Forest", 
       Agricultural = "Hay/Pasture", 
       Natural = "Herbaceous", 
       Natural = "Mixed Forest", 
       Discarded = "Open Water", 
       Natural = "Shrub/Scrub", 
       Natural = "Woody Wetlands")) %>% 
arrange(desc(Occurrences)) %>%  
kbl(col.names = c("Original NLCD Cover class", "Occurrences", "Assigned cover class"), caption = "\\textbf{Table S1.} Original downloaded cover classes for United States with the respective assigned cover classes and number of bee occurrences found on each of them.",
booktabs = T, align = c("l", "c", "l"), linesep = "") %>% 
kable_styling(font_size = 12, latex_options = c("hold_position", "striped")) %>% 
row_spec(0,bold=TRUE)

```

\clearpage

```{r Table S2, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE, fig.align="center"}

#Create table of occurrences per habitat type (USA)
#Load libraries
library(tidyverse)
library(kableExtra)

#Load extracted data
pref <- read_csv("../Data/Europe_data/land_cover_europe.csv.gz") %>% 
    dplyr::select(Species, Cover_names) %>% 
    mutate_if(is.character,as.factor) 

#Create table with original and new cover categories
pref %>% 
select(Cover_names) %>% 
group_by(Cover_names) %>% 
summarise(Occurrences = length(Cover_names)) %>% 
mutate(Cover_names1 = fct_recode(as.factor(Cover_names),
      Urban = "Airports", #1
      Discarded = "Bare rocks", #2
      Natural = "Beaches, dunes, sands", #3
      Natural = "Broad-leaved forest", #4
      Natural = "Coastal lagoons", #5
      Agricultural = "Complex cultivation patterns", #6
      Natural = "Coniferous forest", #7
      Urban = "Construction sites", #8
      Urban = "Continuous urban fabric", #9
      Urban = "Discontinuous urban fabric", #10
      Discarded = "Dump sites", #11
      Discarded = "Estuaries", #12
      Agricultural = "Fruit trees and berry plantations", #13
      Urban = "Green urban areas", #14)
      Urban = "Industrial or commercial units", #15
      Natural = "Inland marshes", #16
      Natural = "Intertidal flats", #17
      Agricultural = "Land principally occupied by agriculture, with significant areas of natural vegetation", #18
      Discarded = "Mineral extraction sites", #19
      Natural = "Mixed forest", #20
      Natural = "Moors and heathland", #21
      Agricultural = "Natural grasslands", #22
      Agricultural = "Non-irrigated arable land", #23
      Agricultural = "Pastures", #24
      Natural = "Peat bogs", #25
      Urban = "Port areas", #26) 
      Discarded = "Road and rail networks and associated land", #27
      Natural = "Salt marshes", #28
      Discarded = "Sea and ocean", #29
      Natural = "Sparsely vegetated areas", #30
      Urban = "Sport and leisure facilities", #31
      Natural = "Transitional woodland-shrub", #32
      Agricultural = "Vineyards", #33
      Discarded = "Water bodies", #34
      Discarded = "Water courses" #35  
)) %>% 
mutate(Cover_names = fct_recode(as.factor(Cover_names),
      "Land principally occupied by agriculture" = "Land principally occupied by agriculture, with significant areas of natural vegetation")) %>% 
arrange(desc(Occurrences)) %>%  
kbl(col.names = c("Original CLC Cover class", "Occurrences", "Assigned cover class"), caption = "\\textbf{Table S2.} Original downloaded cover classes for Europe with the respective assigned cover classes and number of bee occurrences found on each of them.",booktabs = T,
align = c("l", "c", "l"), linesep = "") %>% 
kable_styling(font_size = 12,latex_options = c("hold_position", "striped")) %>% 
row_spec(0,bold=TRUE)

```


```{r, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE,fig.align="center", fig.height=6, fig.width=7, fig.cap="\\textbf{Figure S1.} Association between the log-transformed values of brain and body size (N = 116). The different raw values or points are coloured by the subfamily taxonomic rank.", fig.pos="p", out.width="80%"}

#Plot encephalization
#Load libraries
library(stringr)
library(readr)
library(ggplot2)
library(dplyr)
library(elementalist) #devtools::install_github("teunbrand/elementalist")

#Read data
m = read_csv("../Data/Processing/residuals_model.csv")
r = read_csv("../Data/Processing/residuals_data.csv")
d = read_csv("../Data/Processing/taxonomic_rank.csv") %>% 
mutate(Species = str_replace_all(query, " ", "_")) %>% 
select(!c(query, db))

#Add taxonomic rank to dataset
r = left_join(r,d)

#Add ggplot
ggplot(m, aes(x = log_it, y = estimate__)) +
geom_line(size=1) +
geom_point(data = r, aes(log_it, log_brain_weight, color = subfamily), size=3.5) + 
theme_bw() +
ylab("log(Brain size)") +
xlab("log(Body size)") +
theme(legend.position = c(.95, .60),
legend.justification = c("right", "top"),
legend.box.just = "right",
legend.background = element_rect_round(radius = unit(0.2, "snpc"),fill = "grey85"),
legend.key = element_rect(fill = "grey85")) +
guides(colour=guide_legend(title="Subfamily")) +
theme(axis.title = element_text(face = "bold"))

```



```{r, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE,fig.align="center", fig.height=6, fig.width=8, fig.cap="\\textbf{Figure S2}. Association between relative brain size (A and D), brain weight (B and E) and intertegular distance (C and F) with habitat preference separated by habitat type (i.e., natural, agricultural and urban) and geographical region (USA in the upper panel and Europe in the lower one). The shaded and coloured areas by habitat type represent 95\\% credible intervals.", fig.pos="p", out.width="100%"}

plot_all = readRDS("../Data/Processing/plot_all.rds")

plot_all

```


